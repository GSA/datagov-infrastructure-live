version: 2
jobs:
  validate:
    docker:
      - image: hashicorp/terraform
        entrypoint: ["/bin/sh"]
    environment:
      # Only in terragrunt v0.19
      TERRAGRUNT_DISABLE_INIT: 1
    steps:
      - checkout
      - run:
          name: install terragrunt
          command: |
            curl -L 'https://github.com/gruntwork-io/terragrunt/releases/download/v0.19.19/terragrunt_linux_amd64' > /usr/local/bin/terragrunt
            chmod +x /usr/local/bin/terragrunt
      - run:
          name: validate test
          # TODO https://github.com/gruntwork-io/terragrunt/issues/597
          # Terragrunt <=v0.18.x does not support running validate-all without
          # credentials. We could upgrade to v0.19 with terraform v0.12.
          command: |
            cd ci
            echo no tests

workflows:
  version: 2
  commit:
    jobs:
      - validate
